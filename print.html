<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js navy">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>sovon limited - eep capital</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "navy";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="1_intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="2_conventions.html"><strong aria-hidden="true">2.</strong> Conventions</a></li><li class="chapter-item expanded "><a href="3_examples.html"><strong aria-hidden="true">3.</strong> Examples</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="3_1_influxdb2.html"><strong aria-hidden="true">3.1.</strong> Fill influxdb2 with live data</a></li></ol></li><li class="chapter-item expanded "><a href="4_kcs.html"><strong aria-hidden="true">4.</strong> Key code segments</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="4_1_market.html"><strong aria-hidden="true">4.1.</strong> market</a></li><li class="chapter-item expanded "><a href="4_2_market_storer.html"><strong aria-hidden="true">4.2.</strong> market_storer</a></li></ol></li><li class="chapter-item expanded "><a href="98_fun.html"><strong aria-hidden="true">5.</strong> Fun</a></li><li class="chapter-item expanded "><a href="99_references.html"><strong aria-hidden="true">6.</strong> References</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">sovon limited - eep capital</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/sovon-l/document" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>This project aims to create a low latency trading system in rust. By taking advantage of rust package manager, I expect this project could easily assemble different parts of the trading system into a single binary and provide optimal solutions in every scenario.</p>
<p>The (temporary) project structure will be listed below:</p>
<h2 id="market"><a class="header" href="#market">Market</a></h2>
<p>This is the most readily available module. By passing the instruments to it as arguments, you could get a steady stream of data. The stream of data is published in anyway defined in the messenger crate: Either in memory (crossbeam channel / bus), or through zmq and serialization.</p>
<p>This is expected to be deployed at multiple locations.</p>
<h3 id="market-storer"><a class="header" href="#market-storer">Market Storer</a></h3>
<p>This is a simple golang component that demonstrate the use of zmq sbe transfer on market data, available for benchmarking usage.</p>
<h2 id="gateway"><a class="header" href="#gateway">Gateway</a></h2>
<p>This manages connection directly to the exchange. Besides, it also contains some critical role such as synthesizing orders. One example is if the exchange doesn't support stop loss order, gateway will need to listen to the instrument market data and play after trigger condition occurs. There are more orders to synthesize, like adaptive midprice / OCO / OTO etc.</p>
<p>As the example suggests, gateway is expected to be compiled with market component (as gateway should be the nearest component to exchange venue) to react on price or other market actions.</p>
<h2 id="oepms"><a class="header" href="#oepms">OEPMS(?)</a></h2>
<p>This is the (virtual) component(s) that expects to do several jobs:</p>
<ul>
<li>Split the strategies (multi-tenant). This helps multiple strategies could act on same fund pool.</li>
<li>Deposit / Withdraw fund for the strategies.</li>
<li>Internal order matching. This could help our strategies to save commission fees from acting at exchange venue.</li>
<li>Securities lending?</li>
<li>Risk management? Eyes on leverages / loan value etc</li>
<li>Issue command to transfer funds between exchange venues?</li>
</ul>
<p>This is still at pre-design stage.</p>
<h2 id="strategies"><a class="header" href="#strategies">Strategies</a></h2>
<p>As its name, the real strategy on market. At this stage, I'm open to selections like python notebook or anything that allow more strategists joining the trading system and work together.</p>
<p>This product could expect a market component assisting it. Since there is (great) possibility that rust is not used here, zmq sbe support is required (but could be wrapped into a library).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="conventions"><a class="header" href="#conventions">Conventions</a></h1>
<p>This is to explain the existing conventions used in the project.</p>
<h2 id="1-instrument"><a class="header" href="#1-instrument">1. Instrument</a></h2>
<p>There are three type of conventions.</p>
<ol>
<li>
<p>Encoding format - we use the instrument type defined at market_definition.</p>
</li>
<li>
<p>In memory format - we use instrument enum define at (rust) market.</p>
</li>
<li>
<p>String format - we use &quot;{exchange}:{quote}_{base}(-{type})&quot; - where () means optional. without () auto means &quot;-0&quot;. The type definitions are as below:</p>
<ul>
<li>&quot;-0&quot; means <strong>spot</strong></li>
<li>&quot;-1&quot; means <strong><em>perpetual</em> future</strong>
<ul>
<li>&quot;-1_1654693200&quot; means future that <strong>expires</strong> at epoch 1654693200</li>
</ul>
</li>
<li>&quot;-2&quot; means perpetual <strong>inverse</strong> future
<ul>
<li>&quot;-2_1654693200&quot;</li>
</ul>
</li>
<li>&quot;-3_1654693200_P_20000&quot; means <strong><em>put</em> option</strong> that <strong>expires</strong> at epoch 1654693200 with a <strong>strike</strong> price 20000</li>
<li>&quot;-4_1654693200_C_20000&quot; means <strong>call <em>inverse</em> option</strong> that <strong>expires</strong> at epoch 1654693200 with a <strong>strike</strong> price 20000</li>
</ul>
</li>
</ol>
<p>glossary:</p>
<ul>
<li>
<p>spot, future, option, strike, call put, expire... go back and study la...</p>
</li>
<li>
<p>inverse product means product that calculates at the given pair but settle at quote currency. e.g. you short BTC_USD-2 with volume 50000 USD when the quoted price is 50000, it will take 1 BTC position from your wallet; then when you square off your position at quoted price 25000, you will gain 2 BTC your wallet. I think it is mainly used in short positions.</p>
</li>
</ul>
<p>reference: market:/src/structs/instrument.rs</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="examples"><a class="header" href="#examples">Examples</a></h1>
<p>This sections store examples on how to use components from the project.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="store-live-data-to-influx-db"><a class="header" href="#store-live-data-to-influx-db">Store live data to influx db</a></h1>
<p>This guides you to build a local simple raw data storage solution from live data of supported crypto exchange venue to a local influxdb. These are the rough guidelines:</p>
<p>Prereq:</p>
<ul>
<li>Linux environment (wsl2 or real linux)</li>
<li>influxdb2 installation (I personally suggest a k3s with helm installing bitnami/influxdb)</li>
<li>rust installation through rustup (I use 1.61)</li>
<li>go installation (I use 1.18)</li>
</ul>
<p>Procedure:</p>
<ol>
<li>
<p><code>cargo run --example async_publisher</code> at market:/</p>
<p>It might fail compilation and require you to install sth for libzmq or libczmq-dev sth like that. follow the instructions on compiler or zmq website to proceed</p>
</li>
<li>
<p><code>go run .</code> at market_storer:/</p>
<p>Remember to pass correct environment variable to configure market_storer connect to influxdb2. read market_storer:/env_var.go</p>
</li>
<li>
<p><code>curl localhost:7800 -d '[&quot;binance:btc_usdt&quot;,&quot;binance:eth_usdt&quot;]' -H &quot;Content-Type: application/json&quot;</code></p>
</li>
<li>
<p>Verify there is data by observing log of market_storer. There should have no more warning message &quot;no point to influx2&quot;.</p>
</li>
<li>
<p>Explore the data in your influxdb2! You may also optionally install grafana and configure to view influxdb2 with influxdb1 sql-like syntax.</p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="key-code-segments"><a class="header" href="#key-code-segments">Key code segments</a></h1>
<p>This section serves for providing guidelines to read the code. This is not meant to be an API doc. (API doc should be in form of rustdoc - which there is no such thing at the current stage)</p>
<p>The purpose of this section is to help you identify how to operate the components, hence you may use them to assemble your required trading system.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="market-1"><a class="header" href="#market-1">Market</a></h1>
<p>The purpose of product &quot;Market&quot; is to deliver market data only. Market data has a variety of usage, including but not limited to: synthesizing algo orders, generating signals, initiating trade strategies, forming data lake. Although a single source of truth for market data seems preferrable, but sometimes it is not a part of originating business requirement.</p>
<p>To operate this module, some key points have to be observed:</p>
<ul>
<li>
<p><code>/src/api/</code> It expects other component to use API inside this folder to access data from market component. Specifically, <code>market_listener</code> expect people to implement the trait there and process in inherited functions when market data arrives.</p>
</li>
<li>
<p><code>/src/structs/</code> lists some common public data structures that might be used by other components.</p>
</li>
<li>
<p><code>/src/data/</code> includes the core of market component - the connectivity to different exchanges. <code>/src/data/controller.rs</code> includes an function <code>work()</code> to allow user initiate access to exchange venues, start crawling data, and passing the data to <code>sender</code>. It is currently a crossbeam channel, but is subject to improvement (e.g. <code>impl Sink</code>).</p>
</li>
<li>
<p><code>/src/utils/</code> stores function that does not directly serve the purpose of Market but is essential, and is reduced into reuseable patterns.</p>
</li>
</ul>
<p>For the first demonstration purpose, this component is containerized and is ready to be run as a pod of k8s - using zme sbe for data transfer inside the cluster.</p>
<ul>
<li>
<p><code>/Dockerfile</code> includes how to create the image</p>
</li>
<li>
<p><code>/deployment/</code> is the files that make this into a k8s component. As you see I have tried hosting it under a k8s in my domain name but that is really very very costly for development purpose, but it worked.</p>
</li>
</ul>
<p>There are some other things that might need to be looked out for.</p>
<ul>
<li>
<p><code>/market_definition</code> (git submodule) does not directly affect the compileable source code of Market, but indeed fixed the version of SBE encoding used by fixing a commit of that repo.</p>
</li>
<li>
<p><code>/proper_market_api</code> (cargo submodule) is actually a generated code base from <code>market_definition</code>. It is most likely not required to examine, but the SBE code generator is sometimes buggy and need you to fix 0.1% of its work to coerce with rust syntax. If you didnt touch it, this is ignorable.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="market-storer-1"><a class="header" href="#market-storer-1">Market Storer</a></h1>
<p>The purpose of product &quot;Market Storer&quot; is to receive market data from <code>Market</code> through SBE ZMQ and put them into influxdb2. The project is actually very simple and short go scripts.</p>
<ul>
<li><code>/main.go</code> contains the logic</li>
<li><code>/parse.go</code> contains some generic parsing logic</li>
<li><code>/env_var.go</code> contains the configurable env var</li>
<li><code>/market_definition</code> is the git submodule for fixing the version of sbe encoding</li>
</ul>
<p>Thats all for the source code of this project.</p>
<p>For your curiousity, these are the rests.</p>
<ul>
<li>
<p><code>/proper_market_api/</code> is the generated code from <code>market_definition</code>. There are some capitalization missing and does not match with golang &quot;bigger capital = public, smaller capital = private&quot; syntax rules, and require some manual fixings. Otherwise it is most likely ignorable.</p>
</li>
<li>
<p><code>/Dockerfile</code> generate a container image</p>
</li>
<li>
<p><code>/k8s.yaml</code> contains yaml scripts that make this a pod inside k8s.</p>
</li>
<li>
<p><code>/goczmq/</code> anchored a specific commit on the goczmq github repository. This is because there was a bug preventing this binary to compile that was fixed at newest commit but not newest release. Could get rid of this once the change is pushed into a versioned release.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><p>\( \int x dx = \frac{x^2}{2} + C \)</p>
<p>I hope we can share strategies knowledge here one day too.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="references"><a class="header" href="#references">References</a></h1>
<p>This is a non-exhaustive list of references that might help to understand the project.</p>
<h2 id="1-sbe-simple-binary-encoding"><a class="header" href="#1-sbe-simple-binary-encoding">1. SBE: Simple Binary Encoding</a></h2>
<p>This is expected to be one of the fastest encoding/decoding scheme for data transfer since it expects its format to fit the memory directly. Some references below:</p>
<ul>
<li><a href="https://github.com/real-logic/simple-binary-encoding">Source Code</a></li>
<li><a href="https://github.com/real-logic/simple-binary-encoding/wiki/Sbe-Tool-Guide">How to use</a></li>
<li><a href="https://github.com/real-logic/simple-binary-encoding/wiki/FIX-SBE-XML-Primer">How to write definition files</a></li>
<li><a href="https://github.com/real-logic/simple-binary-encoding/blob/master/sbe-benchmarks/src/main/resources/fix-message-samples.xml">FIX message definition sample</a></li>
</ul>
<h2 id="2-zmq-not-a-message-queue"><a class="header" href="#2-zmq-not-a-message-queue">2. ZMQ: Not a message queue</a></h2>
<p>The usual MQ products are actually a separate running process that manage the messages. ZMQ although has a queue in its runtime, should still yield a lower transferring latency than having a MQ product between our components. This could help us clear out the flow that requires absolute speed (from receiving market data to place order).</p>
<ul>
<li><a href="https://zguide.zeromq.org/">z guide</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>
    </body>
</html>
